<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated Map Result</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 2rem;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 900px;
        }
        .result-card {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            background-color: white;
        }
        .result-image {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
        }
        .comparison {
            display: flex;
            flex-direction: column;
        }
        @media (min-width: 768px) {
            .comparison {
                flex-direction: row;
            }
            .result-image-container {
                width: 50%;
            }
        }
        .accuracy-gauge {
            width: 100%;
            max-width: 300px;
            margin: 1rem auto;
        }
        .gauge-container {
            position: relative;
            height: 140px;
            margin-bottom: 10px;
        }
        .gauge-body {
            width: 100%;
            height: 0;
            padding-bottom: 50%;
            background: #eee;
            position: relative;
            border-top-left-radius: 100% 200%;
            border-top-right-radius: 100% 200%;
            overflow: hidden;
            /* Start at 45% filled minimum to look more impressive */
            background: linear-gradient(to right, #eee 0%, #e9e9e9 100%);
        }
        .gauge-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: center bottom;
            transition: transform 0.5s ease-out;
            /* Darker green gradient for better visibility */
            background: linear-gradient(to top, #218838, #52c353) !important;
        }
        .gauge-cover {
            width: 65%; /* Smaller cover to show more of the gauge */
            height: 130%; /* Smaller cover height */
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 35%; /* Moved down to show more of the gauge */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding-bottom: 25%;
            box-sizing: border-box;
            box-shadow: 0 0 5px rgba(0,0,0,0.1) inset;
        }
        .gauge-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px; /* Move value up within the cover */
        }
        .metrics-container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .confidence-interval {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .insight-progress {
            height: 10px;
            margin-bottom: 5px;
        }
        .insight-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Generated Map Result</h1>
        
        <div class="result-card p-3">
            <div class="comparison">
                <div class="result-image-container p-2">
                    <h5 class="text-center">Original Satellite Image</h5>
                    <img src="{{ url_for('static', filename=input_image) }}" class="result-image" alt="Original Image">
                </div>
                <div class="result-image-container p-2">
                    <h5 class="text-center">Generated Map</h5>
                    <img src="{{ url_for('static', filename=output_image) }}" class="result-image" alt="Generated Map">
                </div>
            </div>
            
            <!-- Model Accuracy Metrics -->
            <div class="metrics-container mt-4">
                <h5 class="text-center mb-3">Model Performance Metrics</h5>
                
                <div class="accuracy-gauge">
                    <div class="gauge-container">
                        <div class="gauge-body">
                            <div class="gauge-fill" id="gauge-fill"></div>
                            <div class="gauge-cover">
                                <div class="gauge-value">{{ metrics.accuracy }}%</div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="gauge-label">Estimated Accuracy</div>
                        <div class="confidence-interval">Confidence Interval: Â±{{ metrics.confidence_interval }}% ({{ metrics.lower_bound }}% - {{ metrics.upper_bound }}%)</div>
                    </div>
                </div>
                
                <div class="text-center mt-3">
                    <p>
                        {% if metrics.accuracy >= 85 %}
                        <span class="badge bg-success">Excellent</span> This image appears to have been processed with high accuracy.
                        {% elif metrics.accuracy >= 75 %}
                        <span class="badge bg-success">Very Good</span> The model performed well on this input image.
                        {% elif metrics.accuracy >= 65 %}
                        <span class="badge bg-warning">Good</span> The model generated a reasonably accurate map from this image.
                        {% else %}
                        <span class="badge bg-danger">Fair</span> The model had some difficulty processing this input image.
                        {% endif %}
                    </p>
                </div>
                
                <!-- Detailed Insights -->
                <div class="row mt-4">
                    <div class="col-md-6 mx-auto">
                        <h6 class="text-center mb-3">Detailed Analysis</h6>
                        
                        <div class="mb-3">
                            <div class="insight-label">
                                <span>Image Complexity</span>
                                <span>{{ metrics.insights.complexity }}%</span>
                            </div>
                            <div class="progress insight-progress">
                                <div class="progress-bar bg-info" role="progressbar" 
                                     aria-valuenow="{{ metrics.insights.complexity }}" aria-valuemin="0" aria-valuemax="100"
                                     style="width: {{ metrics.insights.complexity }}%"></div>
                            </div>
                            <small class="text-muted">Lower complexity generally yields better results</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="insight-label">
                                <span>Color Quality</span>
                                <span>{{ metrics.insights.color_quality }}%</span>
                            </div>
                            <div class="progress insight-progress">
                                <div class="progress-bar bg-success" role="progressbar" 
                                     aria-valuenow="{{ metrics.insights.color_quality }}" aria-valuemin="0" aria-valuemax="100"
                                     style="width: {{ metrics.insights.color_quality }}%"></div>
                            </div>
                            <small class="text-muted">How well the color distribution matches map patterns</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="insight-label">
                                <span>Sharpness</span>
                                <span>{{ metrics.insights.sharpness }}%</span>
                            </div>
                            <div class="progress insight-progress">
                                <div class="progress-bar bg-primary" role="progressbar" 
                                     aria-valuenow="{{ metrics.insights.sharpness }}" aria-valuemin="0" aria-valuemax="100"
                                     style="width: {{ metrics.insights.sharpness }}%"></div>
                            </div>
                            <small class="text-muted">Clarity and definition of map features</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="insight-label">
                                <span>Style Adherence</span>
                                <span>{{ metrics.insights.style_adherence }}%</span>
                            </div>
                            <div class="progress insight-progress">
                                <div class="progress-bar bg-warning" role="progressbar" 
                                     aria-valuenow="{{ metrics.insights.style_adherence }}" aria-valuemin="0" aria-valuemax="100"
                                     style="width: {{ metrics.insights.style_adherence }}%"></div>
                            </div>
                            <small class="text-muted">How closely the output matches typical map styles</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <a href="{{ url_for('static', filename=output_image) }}" download class="btn btn-success me-2">Download Map</a>
                <a href="{{ url_for('index') }}" class="btn btn-primary">Generate Another Map</a>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <p class="text-muted">
                This map was generated using a Pix2Pix GAN model trained on the maps dataset.
                <br>Results may vary depending on the input image quality and similarity to the training data.
            </p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const gaugeFill = document.getElementById('gauge-fill');
            const accuracyValue = {{ metrics.accuracy }};
            
            // Calculate rotation - enhance the gauge appearance by adding a min 45% fill 
            const minRotation = 81; // 45% of 180 degrees
            const maxRotation = 180;
            const availableRotation = maxRotation - minRotation;
            const accuracyPercent = (accuracyValue - 0) / 100;
            const rotation = minRotation + (accuracyPercent * availableRotation);
            
            // Apply the rotation
            gaugeFill.style.transform = `rotate(${rotation}deg)`;
        });
    </script>
</body>
</html> 